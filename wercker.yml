box: golang

build:
  steps:
    - script:
      name: environment variables
      code: |
        export GOPATH=~
        export PATH=$GOPATH/bin:$PATH

    - script:
      name: os setup
      code: |
        apt -y update --fix-missing
        apt -y install rake bundler

    - setup-go-workspace

    - script:
      name: debug info
      code: |
        uname -a
        go version

    - script:
      name: install dependencies
      code: rake install_deps

    - script:
      name: lint
      code: rake lint

    - script:
      name: unit test
      code: rake unit_test

    - script:
      name: command test
      code: rake command_test

    - script:
      name: coverage report
      code: bash <(curl -s https://codecov.io/bash)

    - script:
      name: build
      code: rake build

    - script:
      name: install
      code: rake install
